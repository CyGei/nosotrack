<!DOCTYPE HTML>
<html>

<head>
	<title>NosoTrack</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
	<link rel="stylesheet" href="https://unpkg.com/vis-network/styles/vis-network.css" />

	<style>
		#network-canvas {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
			pointer-events: none;
		}

		/* Ensure the wrapper sits above the canvas */
		#wrapper {
			position: relative;
			z-index: 2;
		}

		/* Ensure the background div sits behind the canvas */
		#bg {
			z-index: -1;
		}
	</style>
</head>

<body class="is-preload">

	<canvas id="network-canvas"></canvas>

	<div id="wrapper">

		<header id="header">
			<div class="content">
				<div class="inner">
					<h1>NosoTrack</h1>
					<p>A Real-Time Platform for Nosocomial Outbreak Analytics </p>
				</div>
			</div>
			<nav>
				<ul>
					<li><a href="#about">About</a></li>
					<li><a href="#research">Research</a></li>
					<li><a href="#team">Team</a></li>
					<li><a href="#contact">Contact</a></li>
				</ul>
			</nav>
		</header>

		<div id="main">

			<article id="about">
				<h2 class="major">About</h2>
				<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 2rem;">
					<div
						style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 4px; text-align: center; border-bottom: 2px solid #ff073a;">
						<span style="display:block; font-size:0.7rem; color:#888; letter-spacing:1px;">CASES</span>
						<span style="font-size:1.5rem; font-weight:bold; color:#fff;">2.0M</span>
						<span style="display:block; font-size:0.65rem; color:#aaa; margin-top:4px;">US per year</span>
					</div>
					<div
						style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 4px; text-align: center; border-bottom: 2px solid #ff073a;">
						<span style="display: block; font-size: 0.7rem; color: #888; letter-spacing: 1px;">DEATHS</span>
						<span style="font-size: 1.5rem; font-weight: bold; color: #fff;">100K</span>
						<span style="display:block; font-size:0.65rem; color:#aaa; margin-top:4px;">US per year</span>
					</div>
					<div
						style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 4px; text-align: center; border-bottom: 2px solid #ff073a;">
						<span style="display: block; font-size: 0.7rem; color: #888; letter-spacing: 1px;">COST</span>
						<span style="font-size: 1.5rem; font-weight: bold; color: #fff;">$40B+</span>
						<span style="display:block; font-size:0.65rem; color:#aaa; margin-top:4px;">US per year</span>

					</div>
				</div>
				<p style="text-align: justify;">
					<b>Healthcare-associated infections (HAIs)</b> affect approximately 1 in 10 patients worldwide,
					causing significant morbidity, mortality, and economic strain on healthcare systems. <b>Nosocomial
						outbreaks</b>
					driven by person-to-person transmitted pathogens such as SARS-CoV-2, <em>Clostridioides
						difficile</em>, <em>Klebsiella pneumoniae</em>, and MRSA generate the most acute clinical and
					operational crises: triggering staff shortages, ward closures, and delayed procedures.
					Current control measures rely on broad testing and isolation protocols, but <b>effective
						intervention
						requires identifying the specific drivers of an outbreak</b>: such as patient zero,
					superspreaders, transmission routes, and undetected or imported cases. <br><br>
					<span
						style="color: red; font-weight: bold; font-family: Consolas, 'Courier New', Monaco, monospace; font-size: 24px;">
						NosoTrack
					</span>
					<b>is an outbreak
						analytics platform that infers who infected whom in near real-time</b> by integrating data from
					hospital Electronic Health Records with Bluetooth enabled contact tracing. It delivers early
					warnings
					and actionable reports, enabling hospital infection prevention teams to target interventions
					promptly before an outbreak escalates.
				</p>

				<div id="network-container"
					style="position: relative; width:100%; height:400px; border:1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); border-radius: 4px;">
					<div id="mynetwork" style="width:100%; height:100%;"></div>

					<div id="network-legend" style="
        position: absolute; 
        top: 15px; 
        left: 15px; 
        background: rgba(20, 20, 20, 0.8); 
        padding: 12px; 
        border-radius: 4px; 
        border: 1px solid rgba(255, 255, 255, 0.1); 
        font-family: monospace; 
        font-size: 11px; 
        color: #fff; 
        pointer-events: none;
        letter-spacing: 1px;
    ">
						<!-- TYPE Section -->
						<div
							style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
							<div style="font-weight: bold; margin-bottom: 8px; color: #aaa; font-size: 10px;">TYPE</div>
							<div style="display: flex; align-items: center; margin-bottom: 8px;">
								<div
									style="width: 10px; height: 10px; background: #888; border-radius: 50%; margin-right: 10px; box-shadow: 0 0 5px rgba(255,255,255,0.2);">
								</div>
								<span>PATIENT</span>
							</div>
							<div style="display: flex; align-items: center;">
								<div style="
                    width: 0; 
                    height: 0; 
                    border-left: 6px solid transparent; 
                    border-right: 6px solid transparent; 
                    border-bottom: 11px solid #888; 
                    margin-right: 9px;
                    filter: drop-shadow(0 0 3px rgba(255,255,255,0.2));
                "></div>
								<span>STAFF</span>
							</div>
						</div>

						<!-- WARD Section -->
						<div>
							<div style="font-weight: bold; margin-bottom: 8px; color: #aaa; font-size: 10px;">WARD</div>
							<div style="display: flex; align-items: center; margin-bottom: 6px;">
								<div
									style="width: 12px; height: 12px; background: rgba(100, 150, 255, 0.4); border: 1px solid rgba(100, 150, 255, 0.6); margin-right: 10px;">
								</div>
								<span>WARD A</span>
							</div>
							<div style="display: flex; align-items: center; margin-bottom: 6px;">
								<div
									style="width: 12px; height: 12px; background: rgba(255, 150, 100, 0.4); border: 1px solid rgba(255, 150, 100, 0.6); margin-right: 10px;">
								</div>
								<span>WARD B</span>
							</div>
							<div style="display: flex; align-items: center;">
								<div
									style="width: 12px; height: 12px; background: rgba(150, 255, 100, 0.4); border: 1px solid rgba(150, 255, 100, 0.6); margin-right: 10px;">
								</div>
								<span>WARD C</span>
							</div>
						</div>
					</div>
				</div>

			</article>

			<article id="research">
				<h2 class="major">Research</h2>
				<p style="text-align: justify;">
					Novel computational methods that reconstruct who infected whom from clinical, contact, and
					genetic data have proven effective in guiding outbreak control across pathogens such as SARS-CoV-2,
					influenza, Ebola, and antimicrobial-resistant bacteria

					Yet, they remain largely retrospective, with no integration into routine hospital surveillance. What
					is lacking is an automated system capable of deploying these models in near real-time:
					this is the aim of <span style="color: #ff073a; font-weight: bold;">NosoTrack</span>.
				</p>

				<h3>Selected publications and software</h3>

				<div class="pub-grid">

					<a class="pub-card" href="https://pubmed.ncbi.nlm.nih.gov/35215195/" target="_blank">
						<span class="pub-tag">Paper</span>
						<div class="pub-title">Literature review</div>
						<div class="pub-desc">A systematic review of outbreak reconstruction methods.</div>
					</a>

					<a class="pub-card" href="https://link.springer.com/article/10.1186/s12859-018-2330-z"
						target="_blank">
						<span class="pub-tag">Paper</span>
						<div class="pub-title">A modular platform for outbreak reconstruction</div>
						<div class="pub-desc">The paper for outbreaker2.</div>
					</a>

					<a class="pub-card" href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0313037"
						target="_blank">
						<span class="pub-tag">Paper</span>
						<div class="pub-title">linktree</div>
						<div class="pub-desc">A method to infer transmission patterns between staff and patients.</div>
					</a>

					<a class="pub-card" href="https://pubmed.ncbi.nlm.nih.gov/40302215/" target="_blank">
						<span class="pub-tag">Paper</span>
						<div class="pub-title">Real time genomic surveillance for nosocomial outbreaks</div>
						<div class="pub-desc">Proof of concept for near real time surveillance.</div>
					</a>

					<a class="pub-card" href="https://github.com/reconhub/outbreaker2" target="_blank">
						<span class="pub-tag">Software</span>
						<div class="pub-title">outbreaker2</div>
						<div class="pub-desc">Software to reconstruct transmission trees.</div>
					</a>

					<a class="pub-card" href="https://cygei.github.io/o2ools/index.html" target="_blank">
						<span class="pub-tag">Software</span>
						<div class="pub-title">o2ools</div>
						<div class="pub-desc">Software to analyse transmission trees.</div>
					</a>

				</div>

			</article>

			<article id="team">
				<h2 class="major">Team</h2>

				<!-- Cyril -->
				<div style="display:flex; align-items:flex-start; margin-bottom:20px; flex-wrap: wrap;">
					<img src="images/cyril.jpg" alt="Dr Cyril Geismar"
						style="width:150px; border-radius:10%; margin-right:15px; margin-bottom:10px;">
					<p style="text-align: justify; flex:1;">
						<span style="color: #ff073a; font-weight: bold;">Dr Cyril Geismar</span> is a postdoctoral
						research fellow at Johns Hopkins University. He earned his PhD in the mathematical modelling of
						infectious diseases at Imperial College London, where his research focused on developing methods
						and software for SARS-CoV-2 outbreak reconstruction. He serves on the executive board and
						contributes as a software developer for the <a href="https://www.repidemicsconsortium.org/"
							target="_blank">R Epidemics Consortium</a> and teaches outbreak analytics at <a
							href="https://sismid.sph.emory.edu/online-modules/recon-tools/index.html"
							target="_blank">Emory University</a> and <a
							href="https://data.org/our-work/epiverse/training-africa/course/" target="_blank">the London
							School of Hygiene & Tropical Medicine</a>.
					</p>
				</div>

				<!-- Thibaut Jombart -->
				<div style="display:flex; align-items:flex-start; margin-bottom:20px; flex-wrap: wrap;">
					<img src="images/thibaut.jpg" alt="Dr Thibaut Jombart"
						style="width:150px; border-radius:10%; margin-right:15px; margin-bottom:10px;">
					<p style="text-align: justify; flex:1;">
						<span style="color: #ff073a; font-weight: bold;">Dr Thibaut Jombart</span> is a Senior Lecturer
						at Imperial College London specialising in outbreak response analytics, with expertise in
						biostatistics, population genetics, and R programming. He is the lead author of <a
							href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003457"
							target="_blank">outbreaker</a> and
						founder of the <a href="https://www.repidemicsconsortium.org/" target="_blank">R Epidemics
							Consortium</a>. He has field experience in outbreak response, including Ebola deployments in
						the Democratic Republic of the Congo.
					</p>
				</div>

				<!-- Anne Cori -->
				<div style="display:flex; align-items:flex-start; margin-bottom:20px; flex-wrap: wrap;">
					<img src="images/anne.jpg" alt="Dr Anne Cori"
						style="width:150px; border-radius:10%; margin-right:15px; margin-bottom:10px;">
					<p style="text-align: justify; flex:1;">
						<span style="color: #ff073a; font-weight: bold;">Dr Anne Cori</span> is a Senior Lecturer at
						Imperial
						College London specialising in real-time outbreak analysis and estimation of epidemiological
						parameters. She
						is the lead author of <a href="https://academic.oup.com/aje/article/178/9/1505/89262"
							target="_blank">EpiEstim</a> and co-author of <a
							href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003457"
							target="_blank">outbreaker</a>. Her
						research develops statistical methods for outbreak
						reconstruction
						and rapid assessment of transmissibility, integrating epidemiological and genomic data to inform
						control
						strategies.
					</p>
				</div>

				<!-- Shaun Truelove -->
				<div style="display:flex; align-items:flex-start; margin-bottom:20px; flex-wrap: wrap;">
					<img src="images/shaun.jpg" alt="Dr Shaun Truelove"
						style="width:150px; border-radius:10%; margin-right:15px; margin-bottom:10px;">
					<p style="text-align: justify; flex:1;">
						<span style="color: #ff073a; font-weight: bold;">Dr Shaun Truelove</span> is an Associate
						Professor at Johns Hopkins University. His
						work focuses on applying infectious disease dynamics
						and modelling to inform public health response, and policy, particularly for
						COVID-19, influenza, and vaccine-preventable diseases.
						He co-leads the <a href="https://scenariomodelinghub.org/" target="_blank">US Scenario Modeling
							Hubs</a> and <a href="https://insightnet.us/centers/accidda/" target="_blank">ACCIDA</a>, a
						consortium of
						researchers producing epidemic scenario projections and forecasts.
					</p>
				</div>


			</article>



			<article id="contact">
				<h2 class="major">Contact</h2>
				<p>
					We are actively seeking collaborations and funding. Please reach out!
				</p>
				<form method="POST" action="https://formspree.io/f/maqdqzqw">
					<div class="fields">
						<div class="field half">
							<label for="name">Name</label>
							<input type="text" name="name" id="name" />
						</div>
						<div class="field half">
							<label for="email">Email</label>
							<input type="text" name="email" id="email" />
						</div>
						<div class="field">
							<label for="message">Message</label>
							<textarea name="message" id="message" rows="4"></textarea>
						</div>
					</div>
					<ul class="actions">
						<li><input type="submit" value="Send Message" class="primary" /></li>
						<li><input type="reset" value="Reset" /></li>
					</ul>
				</form>
				<ul class="icons">
					<li><a href="https://github.com/CyGei" class="icon brands fa-github"><span
								class="label">GitHub</span></a></li>
				</ul>
			</article>

		</div>

		<footer id="footer">
			<p class="copyright">&copy; Cyril Geismar.</p>
		</footer>

	</div>

	<div id="bg"></div>

	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<script>
		(function () {
			const canvas = document.getElementById('network-canvas');
			const ctx = canvas.getContext('2d');
			let width, height;
			let particles = [];

			// CONFIGURATION
			const particleCount = 110;       // Denser network
			const connectionDistance = 140;  // How close to draw lines
			const infectionDistance = 140;   // Infection transmission range (same as lines)
			const particleSpeed = 0.6;       // Speed of movement

			// VISUALS
			const healthyColor = 'rgba(200, 200, 200, 0.6)'; // Grey
			const infectedColor = 'rgba(255, 50, 50, 0.9)';  // Red
			const healthyLine = '200, 200, 200';
			const infectedLine = '255, 50, 50';

			// INFECTION LOGIC
			const infectionChance = 0.02;    // Chance to infect per frame per contact (2%)
			const recoveryTime = 600;        // Frames until recovery (approx 10 seconds @ 60fps)

			// Resize handling
			function resize() {
				width = canvas.width = window.innerWidth;
				height = canvas.height = window.innerHeight;
			}
			window.addEventListener('resize', resize);
			resize();

			// Particle Class
			class Particle {
				constructor() {
					this.x = Math.random() * width;
					this.y = Math.random() * height;
					this.vx = (Math.random() - 0.5) * particleSpeed;
					this.vy = (Math.random() - 0.5) * particleSpeed;
					this.size = Math.random() * 2 + 1;

					this.isInfected = false;
					this.infectionTimer = 0;
				}

				infect() {
					if (!this.isInfected) {
						this.isInfected = true;
						this.infectionTimer = recoveryTime;
					}
				}

				update() {
					// Move
					this.x += this.vx;
					this.y += this.vy;

					// Bounce off edges
					if (this.x < 0 || this.x > width) this.vx *= -1;
					if (this.y < 0 || this.y > height) this.vy *= -1;

					// Handle Infection Timer
					if (this.isInfected) {
						this.infectionTimer--;
						if (this.infectionTimer <= 0) {
							this.isInfected = false; // Recover
						}
					}
				}

				draw() {
					ctx.fillStyle = this.isInfected ? infectedColor : healthyColor;
					ctx.beginPath();
					ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
					ctx.fill();
				}
			}

			// Initialize particles
			function initParticles() {
				particles = [];
				for (let i = 0; i < particleCount; i++) {
					let p = new Particle();
					// Randomly infect a few "Patient Zeros"
					if (Math.random() < 0.05) {
						p.infect();
					}
					particles.push(p);
				}
			}
			initParticles();

			// Animation Loop
			function animate() {
				ctx.clearRect(0, 0, width, height);

				// Re-ignite infection if everyone recovers
				if (!particles.some(p => p.isInfected)) {
					// Pick a random lucky winner to restart the outbreak
					particles[Math.floor(Math.random() * particles.length)].infect();
				}

				for (let i = 0; i < particles.length; i++) {
					particles[i].update();
					particles[i].draw();

					// Check connections
					for (let j = i; j < particles.length; j++) {
						const dx = particles[i].x - particles[j].x;
						const dy = particles[i].y - particles[j].y;
						const distance = Math.sqrt(dx * dx + dy * dy);

						if (distance < connectionDistance) {
							// Infection Spread Logic
							if (particles[i].isInfected && !particles[j].isInfected) {
								if (Math.random() < infectionChance) particles[j].infect();
							} else if (!particles[i].isInfected && particles[j].isInfected) {
								if (Math.random() < infectionChance) particles[i].infect();
							}

							// Draw Line
							ctx.beginPath();
							const opacity = 1 - (distance / connectionDistance);

							// If either is infected, line is red
							if (particles[i].isInfected || particles[j].isInfected) {
								ctx.strokeStyle = `rgba(${infectedLine}, ${opacity})`;
							} else {
								ctx.strokeStyle = `rgba(${healthyLine}, ${opacity * 0.5})`; // Fainter lines for healthy
							}

							ctx.lineWidth = 1;
							ctx.moveTo(particles[i].x, particles[i].y);
							ctx.lineTo(particles[j].x, particles[j].y);
							ctx.stroke();
						}
					}
				}
				requestAnimationFrame(animate);
			}
			animate();
		})();
	</script>

	<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
	<script>
		(function () {
			const container = document.getElementById('mynetwork');

			const COLORS = {
				healthy: '#444444',
				infected: '#ff073a',
				superspreader: '#ff0000',
				healthyBorder: '#666666',
				text: '#ffffff',
				edge: 'rgba(255, 255, 255, 0.15)',
				wardA: 'rgba(100, 150, 255, 0.2)',
				wardB: 'rgba(255, 150, 100, 0.2)',
				wardC: 'rgba(150, 255, 100, 0.2)',
				wardABorder: 'rgba(100, 150, 255, 0.5)',
				wardBBorder: 'rgba(255, 150, 100, 0.5)',
				wardCBorder: 'rgba(150, 255, 100, 0.5)'
			};

			// Ward boundaries (square boxes)
			const WARDS = {
				A: { xCenter: -400, yBase: 0, width: 300, label: 'Ward A', color: COLORS.wardA, borderColor: COLORS.wardABorder },
				B: { xCenter: 0, yBase: 0, width: 300, label: 'Ward B', color: COLORS.wardB, borderColor: COLORS.wardBBorder },
				C: { xCenter: 400, yBase: 0, width: 300, label: 'Ward C', color: COLORS.wardC, borderColor: COLORS.wardCBorder }
			};

			// Helper function to add small random noise to y-coordinate
			const noise = (baseY) => baseY + (Math.random() - 0.5) * 40;

			// Helper to position node within ward bounds
			const wardPos = (ward, yBase, xOffset = 0) => ({
				x: WARDS[ward].xCenter + xOffset + (Math.random() - 0.5) * 80,
				y: WARDS[ward].yBase + yBase + noise(0)
			});

			// Node assignments to wards
			const nodeData = [
				{ id: 1, label: 'P0', ward: 'A', y: 0, xOffset: 0 },
				{ id: 2, label: 'S1', ward: 'A', y: 70, xOffset: 50 },
				{ id: 3, label: 'S2', ward: 'B', y: 50, xOffset: 0 },
				{ id: 4, label: 'P3', ward: 'A', y: 200, xOffset: 50 },
				{ id: 5, label: 'P4', ward: 'A', y: 180, xOffset: 80 },
				{ id: 6, label: 'P5', ward: 'B', y: 150, xOffset: -50 },
				{ id: 7, label: 'P6', ward: 'B', y: 200, xOffset: 50 },
				{ id: 8, label: 'P7', ward: 'C', y: 200, xOffset: 0 },
				{ id: 10, label: 'S3', ward: 'B', y: 250, xOffset: 0 },
				// Generation 4: Superspreader burst
				{ id: 9, label: 'P2', ward: 'A', y: 320, xOffset: 0 },
				{ id: 11, label: 'S4', ward: 'A', y: 400, xOffset: 60 },
				{ id: 12, label: 'P10', ward: 'B', y: 400, xOffset: -70 },
				{ id: 13, label: 'S5', ward: 'B', y: 500, xOffset: 0 },
				{ id: 14, label: 'P12', ward: 'B', y: 450, xOffset: 80 },
				{ id: 15, label: 'P13', ward: 'B', y: 400, xOffset: 30 },
				{ id: 16, label: 'S6', ward: 'C', y: 400, xOffset: -40 },
				{ id: 18, label: 'S7', ward: 'C', y: 300, xOffset: 50 },
				// Later generations
				{ id: 19, label: 'P17', ward: 'C', y: 500, xOffset: 60 },
				{ id: 20, label: 'P18', ward: 'C', y: 550, xOffset: -70 },
				{ id: 21, label: 'S8', ward: 'A', y: 400, xOffset: -30 },
				{ id: 17, label: 'P15', ward: 'C', y: 520, xOffset: 20 },
				{ id: 22, label: 'P20', ward: 'A', y: 510, xOffset: 40 },
				{ id: 23, label: 'P21', ward: 'A', y: 510, xOffset: -50 }
			];

			// Create nodes with ward-based positioning
			const nodes = new vis.DataSet(
				nodeData.map(n => {
					const pos = wardPos(n.ward, n.y, n.xOffset);
					const isStaff = n.label.startsWith('S');
					return {
						id: n.id,
						label: n.label,
						shape: isStaff ? 'triangle' : 'dot',
						size: (n.id === 10) ? 40 : 25,
						x: pos.x,
						y: pos.y,
						ward: n.ward
					};
				})
			);

			const edges = new vis.DataSet([
				// Generation 0 → Generation 1
				{ id: 'e1', from: 1, to: 2 },
				{ id: 'e2', from: 1, to: 3 },

				// Generation 1 → Generation 2
				{ id: 'e3', from: 2, to: 4 },
				{ id: 'e4', from: 2, to: 5 },
				{ id: 'e5', from: 3, to: 6 },
				{ id: 'e6', from: 3, to: 7 },
				{ id: 'e7', from: 3, to: 8 },

				// Generation 2 → Generation 3 (Superspreader)
				{ id: 'e8', from: 6, to: 10 },

				// Generation 3 → Generation 4 (Superspreader burst)
				{ id: 's1', from: 10, to: 9 },
				{ id: 's2', from: 10, to: 11 },
				{ id: 's3', from: 10, to: 12 },
				{ id: 's4', from: 10, to: 13 },
				{ id: 's5', from: 10, to: 14 },
				{ id: 's6', from: 10, to: 15 },
				{ id: 's7', from: 10, to: 16 },
				{ id: 's8', from: 10, to: 18 },

				// Generation 4 → Generation 5+
				{ id: 'e9', from: 18, to: 19 },
				{ id: 'e10', from: 18, to: 20 },
				{ id: 'e11', from: 9, to: 21 },
				{ id: 'e12', from: 21, to: 22 },
				{ id: 'e13', from: 21, to: 23 },
				{ id: 'e14', from: 16, to: 17 }
			]);

			const options = {
				layout: {
					hierarchical: {
						enabled: false
					}
				},
				physics: { enabled: false },
				edges: {
					arrows: { to: { enabled: true, scaleFactor: 0.8 } },
					color: { color: COLORS.edge, opacity: 0.3 },
					width: 1.5,
					smooth: { type: 'cubicBezier', roundness: 0.4 }
				},
				nodes: {
					font: { color: COLORS.text, face: 'monospace', size: 20, vadjust: -35 },
					borderWidth: 2,
					color: { background: COLORS.healthy, border: COLORS.healthyBorder }
				},
				interaction: { dragNodes: true, zoomView: true, dragView: true }
			};

			const network = new vis.Network(container, { nodes, edges }, options);

			// Draw ward boxes after network is initialized
			network.on('afterDrawing', function (ctx) {
				// Draw ward boxes (extended vertically)
				Object.values(WARDS).forEach(ward => {
					const halfWidth = ward.width / 2;

					// Convert network coordinates to canvas coordinates
					const topLeft = network.canvasToDOM({ x: ward.xCenter - halfWidth, y: -100 });
					const bottomRight = network.canvasToDOM({ x: ward.xCenter + halfWidth, y: 800 });

					const canvasTopLeft = network.DOMtoCanvas(topLeft);
					const canvasBottomRight = network.DOMtoCanvas(bottomRight);

					// Draw ward box
					ctx.strokeStyle = ward.borderColor;
					ctx.fillStyle = ward.color;
					ctx.lineWidth = 2;

					const boxX = canvasTopLeft.x;
					const boxY = canvasTopLeft.y;
					const boxWidth = canvasBottomRight.x - canvasTopLeft.x;
					const boxHeight = canvasBottomRight.y - canvasTopLeft.y;

					ctx.fillRect(boxX, boxY, boxWidth, boxHeight);
					ctx.strokeRect(boxX, boxY, boxWidth, boxHeight);
				});
			});

			// Fit the network to view after a short delay
			setTimeout(() => network.fit(), 100);

			const observer = new ResizeObserver(() => { network.fit(); });
			observer.observe(container);

			let infectedIds = new Set();
			const SUPERSPREADER_ID = 10;

			function runSimulation() {
				nodes.forEach(n => nodes.update({ id: n.id, color: { background: COLORS.healthy, border: COLORS.healthyBorder }, shadow: false }));
				edges.forEach(e => edges.update({ id: e.id, color: COLORS.edge, width: 1.5 }));
				infectedIds.clear();

				infectNode(1, null);

				const spreadInterval = setInterval(() => {
					let targets = [];

					infectedIds.forEach(id => {
						const downstream = edges.get({ filter: (e) => e.from === id });
						downstream.forEach(edge => {
							if (!infectedIds.has(edge.to)) {
								targets.push({ nodeId: edge.to, edgeId: edge.id, sourceId: id });
							}
						});
					});

					if (targets.length > 0) {
						const superspreaderTargets = targets.filter(t => t.sourceId === SUPERSPREADER_ID);
						if (superspreaderTargets.length > 0 && infectedIds.has(SUPERSPREADER_ID)) {
							superspreaderTargets.forEach(t => infectNode(t.nodeId, t.edgeId));
						} else {
							const t = targets[Math.floor(Math.random() * targets.length)];
							infectNode(t.nodeId, t.edgeId);
						}
					} else {
						clearInterval(spreadInterval);
						setTimeout(runSimulation, 5000);
					}
				}, 800);
			}

			function infectNode(nodeId, edgeId) {
				infectedIds.add(nodeId);
				const isSuperspreader = (nodeId === SUPERSPREADER_ID);

				nodes.update({
					id: nodeId,
					color: { background: COLORS.infected, border: '#ffffff' },
					shadow: {
						enabled: true,
						color: COLORS.infected,
						size: isSuperspreader ? 35 : 12,
						x: 0, y: 0
					}
				});

				if (edgeId) edges.update({ id: edgeId, color: COLORS.infected, width: 3 });
			}

			runSimulation();
		})();
	</script>
</body>

</html>